
plugins {
	id 'info.solidsoft.pitest'
}

compileTestJava.options.encoding = 'UTF-8'

sourceCompatibility = 1.8
targetCompatibility = 1.8

dependencies {
	compileJava {
		options.compilerArgs << '-parameters'
		options.compilerArgs << '-Xlint'
		options.compilerArgs << '-Xlint:-serial'     // Don't care about Java serialization
		options.compilerArgs << '-Xlint:-try'        // Really annoying bogus "auto-closeable never used" warnings
		options.compilerArgs << '-Xlint:-processing' // Not all annotations are meant for compile-time "annotation processing"
	}

	compileTestJava {
		options.compilerArgs << '-parameters'
	}

	annotationProcessor "org.projectlombok:lombok:${lombokVersion}"
	compileOnly "org.projectlombok:lombok:${lombokVersion}"
	testAnnotationProcessor "org.projectlombok:lombok:${lombokVersion}"
	testCompileOnly "org.projectlombok:lombok:${lombokVersion}"

	testImplementation "org.junit.jupiter:junit-jupiter-api:${jUnitVersion}"
	testImplementation "org.junit.jupiter:junit-jupiter-params:${jUnitVersion}"
	testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:${jUnitVersion}"

	testImplementation "org.testcontainers:testcontainers:${testcontainersVersion}"
	testImplementation "org.testcontainers:junit-jupiter:${testcontainersVersion}"
	testImplementation "org.testcontainers:toxiproxy:1.16.2"

	testImplementation "org.hamcrest:hamcrest:${hamcrestVersion}"
	testImplementation "org.hamcrest:hamcrest-library:${hamcrestVersion}"

	implementation "com.github.spotbugs:spotbugs-annotations:${spotbugsVersion}"
	implementation "org.mongodb:mongo-java-driver:${mongoDriverVersion}"
	implementation "com.google.code.gson:gson:${gsonVersion}"
	implementation "org.slf4j:slf4j-api:${slf4jVersion}"
	implementation group: 'org.ow2.asm', name: 'asm', version: "${asmVersion}"
}

test {
	useJUnitPlatform()

	testLogging.showStandardStreams = true

	reports {
		// Used to convert gradle test output to be understood by Jenkins JUnit publishing
		junitXml.enabled = true
		html.enabled = false
	}
}

pitest {
	junit5PluginVersion = '0.15'
	jvmArgs = ['-ea'] // Our unit tests check for assert statements
	targetClasses = ['org.vena.bosk.Path*']  //by default "${project.group}.*"
	targetTests   = ['org.vena.bosk.PathTest*']
	threads = 4
	outputFormats = ['XML', 'HTML']
	timestampedReports = false
}
